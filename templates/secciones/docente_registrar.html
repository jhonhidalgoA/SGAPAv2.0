{% extends "main.html" %}
{% include "components/modal.html" %}
{% from "macros/macros.j2" import header %}
{% from "macros/buttons.j2" import btn with context %}
{% block title %} M. ADMINISTRADOR | SGAPA {% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/docente_registrar.css') }}">
{% endblock %}

{% block content %}
<div class="tabs">
    {{ header(titulo="Registro Docente", color__fondo="var(--color-green-emerald)") }}
   
    <ul class="tab-nav">
        <li class="active" data-tab="tab1">Datos del Docente</li>
        <li data-tab="tab2">Información Profesional</li>
    </ul>

     <!-- Llamada a campos vacíos desde Flask -->    
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <script>
        showModal("{{ category | title }}", "{{ message | safe}}", null);
    </script>
    {% endfor %}
    {% endif %}
    {% endwith %}
    <!------------------>

   
    <form action="{{ url_for('secciones.guardar_docente') }}" method="post" id="teacherRegistrationForm"
        class="registration__form" enctype="multipart/form-data">
        <div class="tab-content active" id="tab1">
            <div class="student__photo">
                <div class="photo__container">
                    <label for="photo" class="photo__label">
                        <span>Foto del Docente</span>
                        <input type="file" id="photo" name="student_photo" accept="image/*">
                        <div class="photo__preview" id="photoPreview"></div>
                    </label>
                </div>
                <div class="registration__fields">
                    <h3>Datos del Docente</h3>
                    <div class="field__row">
                        <div class="group">
                            <label for="registration_date_teacher">Fecha de Registro:</label>
                            <input type="date" id="registration_date_teacher" name="registration_date_teacher" readonly>
                        </div>
                        <div class="group">
                            <label for="codigo_teacher">Código:</label>
                            <input type="number" id="codigo_teacher" name="codigo_teacher">
                        </div>
                        <div class="group">
                            <label for="teacher_name">Nombres:</label>
                            <input type="text" id="teacher_name" name="teacher_name">
                        </div>
                        <div class="group">
                            <label for="teacher_lastname">Apellidos:</label>
                            <input type="text" id="teacher_lastname" name="teacher_lastname">
                        </div>
                    </div>
                    <div class="field__row">
                        <div class="group">
                            <label for="teacher_birth_date">Fecha de Nacimiento:</label>
                            <input type="date" id="teacher_birth_date" name="teacher_birth_date">
                        </div>
                        <div class="group">
                            <label for="teacher_age">Edad:</label>
                            <input type="number" id="teacher_age" name="teacher_age">
                        </div>
                        <div class="group">
                            <label for="teacher_gender">Género:</label>
                            <select id="teacher_gender" name="teacher_gender">
                                <option value="">Seleccionar</option>
                                <option value="masculino">Masculino</option>
                                <option value="femenino">Femenino</option>
                                <option value="no_binario">No Binario</option>
                            </select>
                        </div>
                        <div class="group">
                            <label for="teacher_birth_place">Lugar de Nacimiento:</label>
                            <input type="text" id="teacher_birth_place" name="teacher_birth_place">
                        </div>
                    </div>
                    <div class="field__row">
                        <div class="group">
                            <label for="teacher_document_type">Tipo de Documento:</label>
                            <select id="teacher_document_type" name="teacher_document_type">
                                <option value="">Seleccionar</option>
                                <option value="cc">Cédula de Ciudadanía (CC)</option>
                                <option value="ce">Cédula de Extranjería (CE)</option>
                                <option value="pep">Permiso Especial de Permanencia (PEP)</option>
                            </select>
                        </div>
                        <div class="group">
                            <label for="teacher_document_number">Número de Documento:</label>
                            <input type="number" id="teacher_document_number" name="teacher_document_number">
                        </div>
                        <div class="group">
                            <label for="teacher_phone">Teléfono:</label>
                            <input type="tel" id="teacher_phone" name="teacher_phone">
                        </div>
                        <div class="group">
                            <label for="teacher_email">Correo Electrónico:</label>
                            <input type="email" id="teacher_email" name="teacher_email"
                                placeholder="ejemplo@dominio.com">
                        </div>
                    </div>
                    <div class="field__row">
                        <div class="group">
                            <label for="profession">Profesión:</label>
                            <input type="text" id="profession" name="profession">
                        </div>
                        <div class="group">
                            <label for="area">Área:</label>
                            <select id="area" name="area">
                                <option value="">Seleccionar</option>
                                <option value="algebra">Álgebra</option>
                                <option value="biologia">Biología</option>
                                <option value="calculo">Cálculo</option>
                                <option value="ciencias de la tierra">Ciencias de la Tierra</option>
                                <option value="constitucion politica">Constitución Política</option>
                                <option value="democracia y paz">Democracia y Paz</option>
                                <option value="educacion artistica">Educación Artística</option>
                                <option value="educacion fisica">Educación Física</option>
                                <option value="español">Español (Gramática, Literatura)</option>
                                <option value="estadistica">Estadística</option>
                                <option value="etica y valores humanos">Ética y Valores Humanos</option>
                                <option value="fisica">Física</option>
                                <option value="geografia">Geografía</option>
                                <option value="geometria">Geometría</option>
                                <option value="historia de colombia">Historia de Colombia</option>
                                <option value="ingles">Inglés (como lengua extranjera)</option>
                                <option value="quimica">Química</option>
                                <option value="tecnologia e informatica">Tecnología e Informática</option>
                            </select>
                        </div>
                        <div class="group">
                            <label for="resolucion">Número de Resolución:</label>
                            <input type="text" id="resolucion" name="resolucion">
                        </div>
                        <div class="group">
                            <label for="scale">Escalafón:</label>
                            <select id="scale" name="scale" required>
                                <option value="1a">1A</option>
                                <option value="1b">1B</option>
                                <option value="1c">1C</option>
                                <option value="1d">1D</option>
                                <option value="2a">2A</option>
                                <option value="2b">2B</option>
                                <option value="2c">2C</option>
                                <option value="2d">2D</option>
                                <option value="3a">3A</option>
                                <option value="3b">3B</option>
                                <option value="3c">3C</option>
                                <option value="3d">3D</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-content tab-2" id="tab2">
            <!-- Información Profesional -->
        </div>
        <div class="ratings__buttons">
            {{ btn(icono="save", texto="Guardar", color="save", tipo="submit") }}
            {{ btn(icono="picture_as_pdf", texto="Generar", color="generate") }}
            {{ btn(icono="delete", texto="Borrar", color="delete") }}
            {{ btn(icono="print", texto="Imprimir", color="print") }}
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static' , filename='js/docente_registrar.js')}}"></script>
<script>
    // === 1. Función confirmLogout() - Salir
    function confirmLogout() {
        window.location.href = "{{ url_for('auth.logout') }}";
    }

    // === 2. Función showModal() - Modal personalizado
    function showModal(title, message, action) {
        const modal = document.getElementById("confirmModal");
        const modalTitle = document.getElementById("modalTitle");
        const modalMessage = document.getElementById("modalMessage");

        if (!modal || !modalTitle || !modalMessage) {
            console.error("No se encontró uno o más elementos del modal");
            alert(`Error: ${message}`);
            return;
        }

        modalTitle.innerText = title;
        modalMessage.innerText = message;
        window.modalAction = action;

        modal.style.display = "flex";
    }

    // === 3. Eventos del modal (Aceptar / Cancelar)
    document.addEventListener("DOMContentLoaded", function () {
        const modalConfirm = document.getElementById("modalConfirm");
        const modalCancel = document.getElementById("modalCancel");

        if (modalConfirm) {
            modalConfirm.addEventListener("click", function () {
                if (typeof modalAction === 'function') {
                    modalAction();
                }
                document.getElementById("confirmModal").style.display = "none";
            });
        }

        if (modalCancel) {
            modalCancel.addEventListener("click", function () {
                document.getElementById("confirmModal").style.display = "none";
            });
        }

        // === 4. Validación de campos vacíos desde Flask ===
        const urlParams = new URLSearchParams(window.location.search);
        const camposVacios = urlParams.get('campos_vacios');

        if (camposVacios) {
            const listaCampos = camposVacios.split(',');
            listaCampos.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.classList.add('input-error');
                }
            });
        }

        // === 5. Limpiar error al escribir ===
        document.querySelectorAll('.registration__form input, .registration__form select').forEach(input => {
            input.addEventListener('input', function () {
                this.classList.remove('input-error');
            });
        });
    });
</script>
{% endblock %}